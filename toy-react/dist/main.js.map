{"version":3,"file":"main.js","sources":["webpack://toy-react/./toy-react.js","webpack://toy-react/webpack/bootstrap","webpack://toy-react/webpack/runtime/define property getters","webpack://toy-react/webpack/runtime/hasOwnProperty shorthand","webpack://toy-react/webpack/runtime/make namespace object","webpack://toy-react/./main.js"],"sourcesContent":["const RENDER_TO_DOM = Symbol.for('render to dom');\r\nclass ElementWrapper{\r\n    constructor(type){\r\n        this.type = type;\r\n        this.root = document.createElement(type);\r\n    }\r\n    setAttribute(name,value){\r\n        if(name.match(/^on([\\s\\S]+)$/)){\r\n            if(typeof value !== 'function'){return console.error(`${RegExp.$1} event must bind with a function.`)}\r\n            this.root.addEventListener(RegExp.$1.replace(/^[\\s\\S]/,v=>v.toLocaleLowerCase()),value);\r\n        }else{\r\n            if(name === \"className\") name = \"class\";\r\n            this.root.setAttribute(name,value);\r\n        }\r\n    }\r\n    appendChild(component){\r\n        let range = document.createRange();\r\n        range.setStart(this.root,this.root.childNodes.length);\r\n        range.setEnd(this.root,this.root.childNodes.length);\r\n        component[RENDER_TO_DOM](range);\r\n    }\r\n    get vdom(){\r\n        return {\r\n            type:this.type,\r\n            props:this.props,\r\n            children:this.children.map(v=>v.vdom)\r\n        }\r\n    }\r\n    [RENDER_TO_DOM](range){\r\n        range.deleteContents();\r\n        range.insertNode(this.root);\r\n    }\r\n}\r\nclass TextWrapper{\r\n    constructor(content){\r\n        this.root = document.createTextNode(content);\r\n    }\r\n    [RENDER_TO_DOM](range){\r\n        range.deleteContents();\r\n        range.insertNode(this.root);\r\n    }\r\n}\r\nclass Component{\r\n    constructor(){\r\n        this.props = Object.create(null);\r\n        this.props.children = [];\r\n        this._root = null;\r\n        this.state = null;\r\n        this._range = null;\r\n    }\r\n    setState(partState,callback){\r\n        let merge = function(oldState,newState){\r\n            for(var i in newState){\r\n                if(oldState[i] === null || typeof oldState[i] !== 'object'){\r\n                    oldState[i] = newState[i];\r\n                }else{\r\n                    // if(typeof oldState[i] === 'object' && typeof oldState[i] === 'undefined'){\r\n                    //     oldState[i] = (newState[i] instanceof Array)?new Array():Object.create(null);\r\n                    // }\r\n                    merge(oldState[i],newState[i]);\r\n                }\r\n            }\r\n        }\r\n        merge(this.state,partState);\r\n        console.log(partState,this.state);\r\n        this.rerender();\r\n    }\r\n    setAttribute(name,value){\r\n       this.props[name] = value;\r\n    }\r\n    appendChild(component){\r\n        this.props.children.push(component);\r\n    }\r\n    [RENDER_TO_DOM](range){\r\n        this._range = range;\r\n        this.render()[RENDER_TO_DOM](range);\r\n    }\r\n    rerender(){\r\n       let oldRange = this._range;\r\n       let range = document.createRange();\r\n       range.setStart(oldRange.startContainer,oldRange.startOffset);\r\n       range.setEnd(oldRange.startContainer,oldRange.startOffset);\r\n       this[RENDER_TO_DOM](range);\r\n       //let selection = window.getSelection();\r\n       oldRange.setStart(range.endContainer,range.endOffset);\r\n       //selection.addRange(oldRange);\r\n       oldRange.deleteContents();\r\n    }\r\n}\r\nfunction createElement(type,attributes,...children){\r\n    let e;\r\n    if(typeof type === 'string'){\r\n        e = new ElementWrapper(type);\r\n    }else{\r\n        e = new type;\r\n    }\r\n    for(let p in attributes){\r\n        e.setAttribute(p,attributes[p]);\r\n    }\r\n    let insertChildren = function(children){\r\n        for(let child of children){\r\n            if(child === null || JSON.stringify(child) === '{}') continue;\r\n            if(typeof child === 'object'){\r\n                if(child instanceof Array){\r\n                    insertChildren(child);  \r\n                    continue;  \r\n                }\r\n            }else{\r\n                child = new TextWrapper(String(child));\r\n            }\r\n            //console.log(child,children);\r\n            e.appendChild(child);\r\n        }\r\n    }\r\n    insertChildren(children);\r\n    return e;\r\n}\r\nfunction render(component,parentElement){\r\n    let range = document.createRange();\r\n    range.setStart(parentElement,0);\r\n    range.setEnd(parentElement,parentElement.childNodes.length);\r\n    range.deleteContents();\r\n    component[RENDER_TO_DOM](range);\r\n}\r\n\r\nexport default class React{\r\n    static render = render;\r\n    static createElement = createElement;\r\n    static Component = Component;\r\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import React from \"./toy-react\";\r\nclass Square extends React.Component{\r\n    render() {\r\n        return (\r\n        <button className=\"square\" onClick={this.props.onClick}>\r\n            {this.props.value}\r\n        </button>\r\n        );\r\n    }\r\n  }\r\n\r\n  class Board extends React.Component {\r\n    renderSquare(i) {\r\n      return (\r\n        <Square\r\n          value={this.props.squares[i]}\r\n          onClick={() => this.props.onClick(i)}\r\n        />\r\n      );\r\n    }\r\n  \r\n    render() {\r\n      return (\r\n        <div>\r\n          <div className=\"board-row\">\r\n            {this.renderSquare(0)}\r\n            {this.renderSquare(1)}\r\n            {this.renderSquare(2)}\r\n          </div>\r\n          <div className=\"board-row\">\r\n            {this.renderSquare(3)}\r\n            {this.renderSquare(4)}\r\n            {this.renderSquare(5)}\r\n          </div>\r\n          <div className=\"board-row\">\r\n            {this.renderSquare(6)}\r\n            {this.renderSquare(7)}\r\n            {this.renderSquare(8)}\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n  \r\n  class Game extends React.Component {\r\n    constructor(props) {\r\n      super(props);\r\n      this.state = {\r\n        history: [\r\n          {\r\n            squares: Array(9).fill(null)\r\n          }\r\n        ],\r\n        stepNumber: 0,\r\n        xIsNext: true\r\n      };\r\n    }\r\n  \r\n    handleClick(i) {\r\n      const history = this.state.history.slice(0, this.state.stepNumber + 1);\r\n      const current = history[history.length - 1];\r\n      const squares = current.squares.slice();\r\n      if (calculateWinner(squares) || squares[i]) {\r\n        return;\r\n      }\r\n      squares[i] = this.state.xIsNext ? \"X\" : \"O\";\r\n      this.setState({\r\n        history: history.concat([\r\n          {\r\n            squares: squares\r\n          }\r\n        ]),\r\n        stepNumber: history.length,\r\n        xIsNext: !this.state.xIsNext\r\n      });\r\n    }\r\n  \r\n    jumpTo(step) {\r\n      this.setState({\r\n        stepNumber: step,\r\n        xIsNext: (step % 2) === 0\r\n      });\r\n    }\r\n  \r\n    render() {\r\n      const history = this.state.history;\r\n      const current = history[this.state.stepNumber];\r\n      const winner = calculateWinner(current.squares);\r\n  \r\n      const moves = history.map((step, move) => {\r\n        const desc = move ?\r\n          'Go to move #' + move :\r\n          'Go to game start';\r\n        return (\r\n          <li key={move}>\r\n            <button onClick={() => this.jumpTo(move)}>{desc}</button>\r\n          </li>\r\n        );\r\n      });\r\n  \r\n      let status;\r\n      if (winner) {\r\n        status = \"Winner: \" + winner;\r\n      } else {\r\n        status = \"Next player: \" + (this.state.xIsNext ? \"X\" : \"O\");\r\n      }\r\n  \r\n      return (\r\n        <div className=\"game\">\r\n          <div className=\"game-board\">\r\n            <Board\r\n              squares={current.squares}\r\n              onClick={i => this.handleClick(i)}\r\n            />\r\n          </div>\r\n          <div className=\"game-info\">\r\n            <div>{status}</div>\r\n            <ol>{moves}</ol>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n  \r\n  // ========================================\r\n  \r\n  React.render(<Game />, document.getElementById(\"root\"));\r\n  \r\n  function calculateWinner(squares) {\r\n    const lines = [\r\n      [0, 1, 2],\r\n      [3, 4, 5],\r\n      [6, 7, 8],\r\n      [0, 3, 6],\r\n      [1, 4, 7],\r\n      [2, 5, 8],\r\n      [0, 4, 8],\r\n      [2, 4, 6]\r\n    ];\r\n    for (let i = 0; i < lines.length; i++) {\r\n      const [a, b, c] = lines[i];\r\n      if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\r\n        return squares[a];\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n  "],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAHA;AAKA;;AACA;AAAA;AACA;AACA;AACA;;;;;;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;;AAAA;AAAA;AACA;AACA;AACA;;;;;;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAbA;AAAA;AAAA;AAAA;AAAA;AAcA;AACA;AAzBA;AAAA;AAAA;AACA;AAwBA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAAA;AACA;AADA;AACA;AADA;AACA;;;A;;;;AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AAAA;;;;;;;;;;;;;AACA;AACA;AACA;AAAA;AAAA;AAIA;;;;AAPA;AACA;AASA;;;;;;;;;;;;;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAFA;AAKA;;;AAEA;AACA;AAEA;AAAA;AAKA;AAAA;AAKA;AAAA;AAOA;;;;AA9BA;AACA;AAgCA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AAEA;AADA;AAIA;AACA;AAPA;AAFA;AAWA;AACA;;;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AADA;AAIA;AACA;AAPA;AASA;;;AAEA;AACA;AACA;AACA;AAFA;AAIA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAGA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAFA;AAKA;AAAA;AAMA;;;;AA7EA;AACA;AACA;AAgFA;AACA;AACA;AACA;AACA;AASA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;;;;A","sourceRoot":""}