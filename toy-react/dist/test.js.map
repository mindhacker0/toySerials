{"version":3,"file":"test.js","sources":["webpack://toy-react/../Animation/index.js","webpack://toy-react/./toy-react.js","webpack://toy-react/webpack/bootstrap","webpack://toy-react/webpack/runtime/define property getters","webpack://toy-react/webpack/runtime/hasOwnProperty shorthand","webpack://toy-react/webpack/runtime/make namespace object","webpack://toy-react/./test.js"],"sourcesContent":["class Timeline { \r\n    constructor(){\r\n        this.animations = new Set(); \r\n        this.finishedAnimaions = new Set(); \r\n        this.addTimes = new Map(); \r\n        this.requestID = null; \r\n        this.state = \"inited\";\r\n        this.tick = () => {\r\n            let t = Date.now() - this.startTime;\r\n            for(let animation of this.animations) {\r\n                let {object, property, template, start, end, duration, timingFunction, delay} = animation;\r\n                let addTime = this.addTimes.get(animation);\r\n                if(t < delay + addTime) continue;\r\n                let progression = timingFunction((t - delay - addTime)/duration); //0-1之间的数值\r\n                if(t > duration + delay + addTime) {\r\n                    progression = 1;\r\n                    this.animations.delete(animation);\r\n                    this.finishedAnimaions.add(animation);\r\n                }\r\n                let value = animation.valueFromProgression(progression);\r\n                console.log(object, property);\r\n                object[property] = template(value);\r\n            }\r\n            if(this.animations.size)\r\n                this. requestID = requestAnimationFrame(this.tick);\r\n            else\r\n                this.requestID = null;\r\n        }\r\n    }\r\n    pause(){ \r\n        if(this.state !== \"playing\") return; \r\n        this.state = \"paused\";\r\n        this.pauseTime = Date.now();\r\n        if(this.requestID !== null){ \r\n            cancelAnimationFrame(this.requestID); \r\n            this.requestID = null;\r\n        }\r\n    }\r\n    resume(){\r\n        if(this.state !== \"paused\") return;\r\n        this.state = \"playing\"\r\n        this.startTime += Date.now() - this.pauseTime; \r\n        this.tick();\r\n    }\r\n    start(){\r\n        if(this.state !== \"inited\") return;\r\n        this.state = \"playing\";\r\n        this.startTime = Date.now();\r\n        this.tick();\r\n    }\r\n    reset(){\r\n        if(this.state === \"playing\") this. pause(); \r\n        this.animations = new Set; \r\n        this.finishedAnimaions = new Set; \r\n        this.addTimes = new Map; \r\n        this.requestID = null; \r\n        this.startTime = Date.now(); \r\n        this.pauseTime = null; \r\n        this.state = \"inited\";\r\n    }\r\n    restart(){\r\n        if(this.state === \"playing\") this.pause();\r\n        for(let animation of this.finishedAnimaions)\r\n        this.animations.add(animation);\r\n        this.finishedAnimaions = new Set();\r\n        this.requestID = null;\r\n        this.state = \"playing\";\r\n        this.startTime = Date.now();\r\n        this.pauseTime = null;\r\n        this.tick();\r\n    }\r\n    add(animation, addTime){\r\n        this.animations.add(animation);\r\n        if(this.state === \"playing\" && this.requestID === null)\r\n          this.tick();\r\n        if(this.state === \"playing\")\r\n          this.addTimes.set(animation, addTime !== void 0 ? addTime : Date.now() - this.startTime)\r\n        else\r\n          this.addTimes.set(animation, addTime !== void 0 ? addTime : 0);\r\n    }\r\n}\r\nclass Animation {\r\n    constructor(object, property , start, end, duration, delay, timingFunction, template) { \r\n        this.object = object;\r\n        this.template = template; \r\n        this.property = property; \r\n        this.start = start;\r\n        this.end = end;\r\n        this.duration = duration;\r\n        this.delay = delay; \r\n        this .timingFunction = timingFunction; //ease linear easeln easeOut\r\n    }\r\n    valueFromProgression(progression) {\r\n        return this.start + progression * (this.end - this.start);\r\n    }\r\n}\r\nclass ColorAnimation {\r\n    constructor(object, property , start, end, duration, delay, timingFunction, template) { \r\n        this.object = object;\r\n        this.template = template || (v =>`rgba(${v.r}, ${v.g}, ${v.b}, ${v.a})`); \r\n        this.property = property;\r\n        this.start = start; \r\n        this.end = end; \r\n        this.duration = duration;\r\n        this.delay = delay; \r\n        this.timingFunction = timingFunction;\r\n    }\r\n    valueFromProgression(progression) {\r\n        return {\r\n            r: thisstart.r + progression * (this.endr - this.start.r), \r\n            g: thisstart.g + progression * (this.end.g - this.start.g), \r\n            b: this.start.b + progression * (this.end.b - this.start.b), \r\n            a: this.start.a + progression * (this.end.a - this.start.a),\r\n        }\r\n    }\r\n}\r\nexport default {\r\n    Timeline:Timeline,\r\n    Animation:Animation,\r\n    ColorAnimation:ColorAnimation,\r\n}","const RENDER_TO_DOM = Symbol.for('render to dom');\r\nclass ElementWrapper{\r\n    constructor(type){\r\n        this.type = type;\r\n        this.root = document.createElement(type);\r\n    }\r\n    setAttribute(name,value){\r\n        if(name.match(/^on([\\s\\S]+)$/)){\r\n            if(typeof value !== 'function'){return console.error(`${RegExp.$1} event must bind with a function.`)}\r\n            this.root.addEventListener(RegExp.$1.replace(/^[\\s\\S]/,v=>v.toLocaleLowerCase()),value);\r\n        }else{\r\n            if(name === \"className\") name = \"class\";\r\n            this.root.setAttribute(name,value);\r\n        }\r\n    }\r\n    appendChild(component){\r\n        let range = document.createRange();\r\n        range.setStart(this.root,this.root.childNodes.length);\r\n        range.setEnd(this.root,this.root.childNodes.length);\r\n        component[RENDER_TO_DOM](range);\r\n    }\r\n    get vdom(){\r\n        return {\r\n            type:this.type,\r\n            props:this.props,\r\n            children:this.children.map(v=>v.vdom)\r\n        }\r\n    }\r\n    [RENDER_TO_DOM](range){\r\n        range.deleteContents();\r\n        range.insertNode(this.root);\r\n    }\r\n}\r\nclass TextWrapper{\r\n    constructor(content){\r\n        this.root = document.createTextNode(content);\r\n    }\r\n    [RENDER_TO_DOM](range){\r\n        range.deleteContents();\r\n        range.insertNode(this.root);\r\n    }\r\n}\r\nclass Component{\r\n    constructor(){\r\n        this.props = Object.create(null);\r\n        this.props.children = [];\r\n        this._root = null;\r\n        this.state = null;\r\n        this._range = null;\r\n    }\r\n    setState(partState,callback){\r\n        let merge = function(oldState,newState){\r\n            for(var i in newState){\r\n                if(oldState[i] === null || typeof oldState[i] !== 'object'){\r\n                    oldState[i] = newState[i];\r\n                }else{\r\n                    // if(typeof oldState[i] === 'object' && typeof oldState[i] === 'undefined'){\r\n                    //     oldState[i] = (newState[i] instanceof Array)?new Array():Object.create(null);\r\n                    // }\r\n                    merge(oldState[i],newState[i]);\r\n                }\r\n            }\r\n        }\r\n        merge(this.state,partState);\r\n        console.log(partState,this.state);\r\n        this.rerender();\r\n    }\r\n    setAttribute(name,value){\r\n       this.props[name] = value;\r\n    }\r\n    appendChild(component){\r\n        this.props.children.push(component);\r\n    }\r\n    [RENDER_TO_DOM](range){\r\n        this._range = range;\r\n        this.render()[RENDER_TO_DOM](range);\r\n    }\r\n    rerender(){\r\n       let oldRange = this._range;\r\n       let range = document.createRange();\r\n       range.setStart(oldRange.startContainer,oldRange.startOffset);\r\n       range.setEnd(oldRange.startContainer,oldRange.startOffset);\r\n       this[RENDER_TO_DOM](range);\r\n       //let selection = window.getSelection();\r\n       oldRange.setStart(range.endContainer,range.endOffset);\r\n       //selection.addRange(oldRange);\r\n       oldRange.deleteContents();\r\n    }\r\n}\r\nfunction createElement(type,attributes,...children){\r\n    let e;\r\n    if(typeof type === 'string'){\r\n        e = new ElementWrapper(type);\r\n    }else{\r\n        e = new type;\r\n    }\r\n    for(let p in attributes){\r\n        e.setAttribute(p,attributes[p]);\r\n    }\r\n    let insertChildren = function(children){\r\n        for(let child of children){\r\n            if(child === null || JSON.stringify(child) === '{}') continue;\r\n            if(typeof child === 'object'){\r\n                if(child instanceof Array){\r\n                    insertChildren(child);  \r\n                    continue;  \r\n                }\r\n            }else{\r\n                child = new TextWrapper(String(child));\r\n            }\r\n            //console.log(child,children);\r\n            e.appendChild(child);\r\n        }\r\n    }\r\n    insertChildren(children);\r\n    return e;\r\n}\r\nfunction render(component,parentElement){\r\n    let range = document.createRange();\r\n    range.setStart(parentElement,0);\r\n    range.setEnd(parentElement,parentElement.childNodes.length);\r\n    range.deleteContents();\r\n    component[RENDER_TO_DOM](range);\r\n}\r\n\r\nexport default class React{\r\n    static render = render;\r\n    static createElement = createElement;\r\n    static Component = Component;\r\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import React from \"./toy-react\";\r\nimport Animation from \"../Animation/index.js\"\r\nclass MyComponent extends React.Component{\r\n    constructor(props){\r\n        super(props);\r\n        setTimeout(()=>{\r\n            let timeLine = new Animation.Timeline;\r\n            let elem = document.getElementById(\"aniNo1\");\r\n            let ani1 = new Animation.Animation(elem.style,\"transform\",0,200,3000,0,v=>v,v=>`translateX(${v}px)`);\r\n            timeLine.add(ani1);\r\n            timeLine.start();\r\n        });\r\n    }\r\n    state={\r\n        a:1,\r\n        b:2\r\n    }\r\n    addNumber(e){\r\n        console.log(e);\r\n        this.setState({a:this.state.a+1});\r\n    }\r\n    render(){\r\n        const {a,b}  = this.state;\r\n        return <div className=\"wrapper\">\r\n            <h1>my component</h1>\r\n            <button onclick={this.addNumber.bind(this)}>add</button>\r\n            <div>\r\n                <div>{a}</div>\r\n                <div>{b}</div>\r\n            </div>\r\n            {this.props.children}\r\n        </div>\r\n    }\r\n}\r\nReact.render(<MyComponent>\r\n    <div id=\"aniNo1\"></div>\r\n    <div id=\"aniNo2\"></div>\r\n</MyComponent>,document.getElementById(\"test\"));"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAAA;AACA;AADA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAfA;AAAA;AAAA;AAAA;AAAA;AACA;AAeA;AAIA;AACA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AAFA;AAAA;AACA;AADA;AAEA;AAAA;AACA;AADA;AAFA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AAEA;AAIA;;;;;;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;;;;;;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;;;;;;AAEA;AACA;AACA;AACA;AAHA;;A;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpHA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAHA;AAKA;;AACA;AAAA;AACA;AACA;AACA;;;;;;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;;AAAA;AAAA;AACA;AACA;AACA;;;;;;AAEA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;AACA;AAAA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAbA;AAAA;AAAA;AAAA;AAAA;AAcA;AACA;AAzBA;AAAA;AAAA;AACA;AAwBA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAAA;AACA;AADA;AACA;AADA;AACA;;;A;;;;AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AAAA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAWA;AACA;AAFA;AACA;AATA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AARA;AASA;AACA;;;AAIA;AACA;AACA;AAAA;AAAA;AACA;;;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AAOA;;;;AA9BA;AACA;AA+BA;AACA;AAAA;AACA;AAAA;;;;A","sourceRoot":""}